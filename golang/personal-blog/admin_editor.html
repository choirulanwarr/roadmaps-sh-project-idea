<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor - Blog Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen py-10 px-4">

    <div class="max-w-3xl mx-auto">
        <!-- Header Navigation -->
        <div class="flex justify-between items-center mb-6">
            <a href="admin_dashboard.html"
                class="flex items-center text-slate-500 hover:text-slate-800 transition-colors text-sm font-medium">
                ‚Üê Kembali
            </a>
            <h1 id="page-title" class="text-lg font-bold text-slate-800">Editor</h1>
            <div class="w-16"></div> <!-- Spacer for alignment -->
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8">
            <form onsubmit="handleSave(event)" class="space-y-6">

                <!-- Title Input (Besar seperti Header) -->
                <div>
                    <input type="text" id="title" required
                        class="w-full text-3xl sm:text-4xl font-bold text-slate-900 placeholder-slate-300 border-none focus:ring-0 px-0"
                        placeholder="Judul Artikel...">
                </div>

                <!-- Date Input -->
                <div class="flex items-center gap-3 text-slate-500">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    <input type="date" id="date" required class="bg-transparent text-sm font-medium w-full focus:outline-none placeholder-slate-400">
                </div>

                <hr class="border-slate-100">

                <!-- Content Area -->
                <div>
                    <textarea id="content" required rows="12"
                        class="w-full text-lg leading-relaxed text-slate-700 placeholder-slate-300 border-none focus:ring-0 px-0 resize-y"
                        placeholder="Tulis cerita menarik Anda di sini..."></textarea>
                </div>

                <!-- Action Bar -->
                <div class="flex justify-end pt-4 border-t border-slate-100">
                    <button type="submit" id="submit-btn"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-semibold shadow-lg shadow-indigo-200 transition-all hover:-translate-y-0.5">
                        Publikasikan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('admin_token');
        if (!token) window.location.href = 'login.html';

        const urlParams = new URLSearchParams(window.location.search);
        const articleId = urlParams.get('id');

        // Jika mode edit, ambil data artikel dulu
        if (articleId) {
            document.getElementById('page-title').innerText = "Edit Artikel";
            document.getElementById('submit-btn').innerText = "Simpan Perubahan";
            loadArticleData(articleId);
        }

        async function loadArticleData(id) {
            const res = await fetch(`http://localhost:8080/articles/${id}`);
            const article = await res.json();

            document.getElementById('title').value = article.title;
            document.getElementById('date').value = article.date;
            document.getElementById('content').value = article.content;
        }

        async function handleSave(e) {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const date = document.getElementById('date').value;
            const content = document.getElementById('content').value;

            const payload = { title, date, content };

            let url = 'http://localhost:8080/articles';
            let method = 'POST';

            if (articleId) {
                url = `http://localhost:8080/articles/${articleId}`;
                method = 'PUT';
            }

            try {
                const res = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` // Token Wajib
                    },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    window.location.href = 'admin_dashboard.html';
                } else {
                    alert("Gagal menyimpan. Pastikan token valid.");
                }
            } catch (err) {
                alert("Koneksi Error");
            }
        }
    </script>
</body>

</html>